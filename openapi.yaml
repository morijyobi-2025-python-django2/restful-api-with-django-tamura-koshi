openapi: 3.0.0
info:
  title: Syllabus API
  version: 0.1.0
  description: シラバスを管理するためのRESTful API
servers:
  - url: http://localhost:8000/api
    description: Development server

components:
  schemas:
    ClassSession:
      type: object
      description: コマシラバス（各授業回の詳細）
      properties:
        id:
          type: integer
          readOnly: true
          example: 1
        order:
          type: integer
          description: 授業の順番
          example: 1
        num_sessions:
          type: integer
          description: コマ数
          example: 1
        content:
          type: string
          description: 授業内容
          example: "オリエンテーション、環境構築"
      required:
        - order
        - num_sessions
        - content

    Syllabus:
      type: object
      properties:
        id:
          type: integer
          readOnly: true
          example: 1
        subject_name:
          type: string
          description: 科目名
          example: "Python応用(Django)②"
        regulation_subject_name:
          type: string
          description: 学則科目名
          example: "システム開発演習"
        teacher_name:
          type: string
          description: 担当教員
          example: "鈴木亮"
        instructor_type:
          type: string
          description: 講師区分
          enum: ["専任教員", "実務教員", "非常勤講師"]
          example: "実務教員"
        teaching_method:
          type: string
          description: 授業方法
          example: "講義&演習"
        num_sessions:
          type: integer
          description: 授業コマ数
          example: 30
        recommended_grade:
          type: string
          description: 推奨履修年次
          example: "2年～"
        enrollment_classification:
          type: string
          description: 履修分類
          enum: ["必修", "必修選択", "選択"]
          example: "必修選択"
        academic_year:
          type: integer
          description: 開講年度
          example: 2025
        semester:
          type: string
          description: 開講期間
          enum: ["前期", "後期", "通年"]
          example: "後期"
        eligible_departments:
          type: array
          description: 履修可能学科
          items:
            type: string
          example: ["高度情報工学科", "総合システム工学科", "情報システム科"]
        course_overview:
          type: string
          description: 授業概要
          example: "まずDjango で RESTful API が作れること。次にDjango 以外のフレームワークでも RESTful API を構築できること。"
        learning_objectives:
          type: string
          description: 到達目標
          example: "RESTful の概念を理解すること。RESTful API の仕様を定義できること。Django で RESTful API が作れること。RESTful APIのテストを書けること。"
        grading_prerequisites:
          type: string
          description: 成績評価の前提条件
          example: "出席率が80%以上であること、および、各評価項目がすべて「可」以上であること"
        grading_criteria:
          type: string
          description: 成績評価基準
          example: "課題の内容評価(50%), 課題提出率(30%), 出席率(20%)"
        required_study_outside_class:
          type: string
          description: 授業外に必要な学習内容
          example: "-"
        textbook:
          type: string
          description: 教材
          example: "なし"
        certification:
          type: string
          description: 検定
          example: "なし"
        textbook_cost:
          type: string
          description: 教材費
          example: "なし"
        certification_cost:
          type: string
          description: 検定費
          example: "なし"
        notes:
          type: string
          description: 履修にあたっての留意点
          example: "本校の「Python応用(Django)①」を履修していること。または、それに当たる能力を有していること。(履修登録する前に教員に相談すること。)"
        remarks:
          type: string
          description: 備考
          example: "-"
        class_sessions:
          type: array
          description: コマシラバス一覧
          items:
            $ref: '#/components/schemas/ClassSession'
        created_at:
          type: string
          format: date-time
          readOnly: true
          example: "2025-12-17T00:00:00+09:00"
        updated_at:
          type: string
          format: date-time
          readOnly: true
          example: "2025-12-17T00:00:00+09:00"
      required:
        - subject_name
        - regulation_subject_name
        - teacher_name
        - instructor_type
        - teaching_method
        - num_sessions
        - recommended_grade
        - enrollment_classification
        - academic_year
        - semester

    PaginatedSyllabusList:
      type: object
      properties:
        count:
          type: integer
          example: 50
        next:
          type: string
          format: uri
          nullable: true
          example: "http://localhost:8000/api/syllabi/?page=2"
        previous:
          type: string
          format: uri
          nullable: true
          example: null
        results:
          type: array
          items:
            $ref: '#/components/schemas/Syllabus'

    Error:
      type: object
      properties:
        detail:
          type: string
          example: "Not found."

  securitySchemes:
    basicAuth:
      type: http
      scheme: basic
    sessionAuth:
      type: apiKey
      in: cookie
      name: sessionid

security:
  - basicAuth: []
  - sessionAuth: []

paths:
  /syllabi/:
    get:
      summary: シラバス一覧取得
      description: すべてのシラバスを取得する（ページネーション付き）
      operationId: listSyllabi
      tags:
        - Syllabi
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
          description: ページ番号
        - name: page_size
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
          description: 1ページあたりの件数
      security: []
      responses:
        '200':
          description: シラバスの配列
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedSyllabusList'
    post:
      summary: シラバス登録
      description: 新しいシラバスを追加する
      operationId: createSyllabus
      tags:
        - Syllabi
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Syllabus'
      responses:
        '201':
          description: 登録されたシラバス
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Syllabus'
        '400':
          description: バリデーションエラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: 認証エラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /syllabi/{id}/:
    get:
      summary: シラバス詳細取得
      description: 指定IDのシラバスを取得する
      operationId: retrieveSyllabus
      tags:
        - Syllabi
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: シラバスのID
      security: []
      responses:
        '200':
          description: シラバス1件
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Syllabus'
        '404':
          description: 指定されたIDのシラバスが見つからない
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    put:
      summary: シラバス更新
      description: 指定IDのシラバスを全更新する
      operationId: updateSyllabus
      tags:
        - Syllabi
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: シラバスのID
      requestBody:
        required: true
        description: 全フィールドを含むJSON
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Syllabus'
      responses:
        '200':
          description: 更新後のシラバス
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Syllabus'
        '400':
          description: バリデーションエラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: 認証エラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: 指定されたIDのシラバスが見つからない
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    patch:
      summary: シラバス部分更新
      description: 指定IDのシラバスを部分更新する
      operationId: partialUpdateSyllabus
      tags:
        - Syllabi
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: シラバスのID
      requestBody:
        required: true
        description: 変更部分のみを含むJSON
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Syllabus'
      responses:
        '200':
          description: 更新後のシラバス
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Syllabus'
        '400':
          description: バリデーションエラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: 認証エラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: 指定されたIDのシラバスが見つからない
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      summary: シラバス削除
      description: 指定IDのシラバスを削除する
      operationId: destroySyllabus
      tags:
        - Syllabi
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: シラバスのID
      responses:
        '204':
          description: 削除成功（No Content）
        '401':
          description: 認証エラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: 指定されたIDのシラバスが見つからない
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

